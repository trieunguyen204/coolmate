<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Đặt hàng thành công - COOLMATE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Tông màu Coolmate: Xanh Navy/Đen (#1E2C3D) và Xám/Trắng */
        body { background-color: #f4f6f8; }

        .main-container {
            max-width: 650px;
            margin: 50px auto;
            background: white;
            padding: 40px 30px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            text-align: center;
        }

        .icon-circle-success {
            width: 80px;
            height: 80px;
            background-color: #28a745;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px auto;
            color: white;
            font-size: 3rem;
        }

        .order-code-box {
            background-color: #f0f3f6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px dashed #1E2C3D;
        }

        .order-detail-header {
            font-weight: 700;
            color: #1E2C3D;
            border-bottom: 2px solid #1E2C3D;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .product-item-summary {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }

        .btn-primary {
            background-color: #1E2C3D;
            border-color: #1E2C3D;
        }
        .btn-primary:hover {
            background-color: #0d1a25;
            border-color: #0d1a25;
        }
    </style>
</head>
<body>

<div class="main-container">
    <div class="icon-circle-success">
        <i class="fas fa-check"></i>
    </div>

    <h1 class="fw-bold" style="color: #28a745;">ĐẶT HÀNG THÀNH CÔNG!</h1>
    <p class="lead text-muted mb-4">Cảm ơn bạn đã tin tưởng và mua sắm tại COOLMATE.</p>

    <div class="order-code-box">
        <p class="mb-0">Mã đơn hàng của bạn:</p>
        <h3 class="fw-bold text-danger mt-1 mb-0" th:text="${order.orderCode}">#CM20240001</h3>
    </div>

    <div class="text-start mb-4">
        <h5 class="order-detail-header"><i class="fas fa-shipping-fast me-2"></i> Thông tin giao hàng</h5>
        <div class="row small text-muted">
            <div class="col-md-6 mb-2">
                <strong>Người nhận:</strong> <span th:text="${order.recipientName}">Nguyễn Văn A</span>
            </div>
            <div class="col-md-6 mb-2">
                <strong>Số điện thoại:</strong> <span th:text="${order.recipientPhone}">0901234567</span>
            </div>
            <div class="col-12 mb-2">
                <strong>Địa chỉ:</strong> <span th:text="${order.deliveryAddress}">Số 123, Đường Xuân Thủy, Cầu Giấy, Hà Nội</span>
            </div>
            <div class="col-12 mb-2">
                <strong>Phương thức TT:</strong> <span th:text="${order.paymentMethod}">Thanh toán khi nhận hàng (COD)</span>
            </div>
        </div>
    </div>

    <div class="text-start">
        <h5 class="order-detail-header"><i class="fas fa-tshirt me-2"></i> Tóm tắt đơn hàng</h5>

        <div th:each="item : ${orderDetails}" class="d-flex justify-content-between align-items-center product-item-summary">
            <span class="text-muted small" th:text="${item.productName} + ' x ' + ${item.quantity}">Áo Polo Dry-Ex Navy (Size L) x 1</span>
            <span class="fw-bold small" th:text="${#numbers.formatDecimal(item.priceAtDate * item.quantity, 0, 'POINT', 0, 'COMMA')} + 'đ'">249.000đ</span>
        </div>

        <div class="text-end mt-3 pt-3 border-top">
            <p th:if="${order.discountAmount != null and order.discountAmount > 0}" class="mb-1">
                Giảm giá: <span class="text-success" th:text="'- ' + ${#numbers.formatDecimal(order.discountAmount, 0, 'POINT', 0, 'COMMA')} + 'đ'"></span>
            </p>
            <h4>Tổng cộng: <span class="text-danger fw-bold" th:text="${#numbers.formatDecimal(order.total, 0, 'POINT', 0, 'COMMA')} + 'đ'"></span></h4>
        </div>
    </div>

    <div class="text-center mt-5">
        <a href="/" class="btn btn-primary px-4"><i class="fas fa-home"></i> Tiếp tục mua sắm</a>
        <a th:href="@{/my-orders}" href="my_orders.html" class="btn btn-outline-secondary px-4 ms-2"><i class="fas fa-history"></i> Lịch sử đơn hàng</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Order success page loaded. Clearing cart...');
        // Xóa giỏ hàng sau khi đặt thành công
        // Đổi key localStorage
        localStorage.removeItem('coolmateCart');
        sessionStorage.removeItem('appliedVoucherCode');
        sessionStorage.removeItem('appliedDiscountAmount');

        // Cập nhật lại số lượng giỏ hàng trên navbar (nếu có)
        if (typeof updateCartBadge === 'function') {
            updateCartBadge();
        }
    });
</script>
</body>
</html>